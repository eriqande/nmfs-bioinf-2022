<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>nmfs-bioinf-2022 - 6&nbsp; Submitting jobs with sbatch</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./summary.html" rel="next">
<link href="./slurm.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Submitting jobs with <code>sbatch</code></span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./" class="sidebar-logo-link">
      <img src="./quarto-static/fisheries_header_logo_jul2019.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">nmfs-bioinf-2022</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome!</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quick-unix-review.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Quick Unix Review</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./shell-prog.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Shell Programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./awk-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Brief <code>awk</code> Intro</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scripts-and-functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bash scripts and functions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./slurm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Sedna and SLURM intro</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sbatch.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Submitting jobs with <code>sbatch</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Summary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eca-setup-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Notes on Eric’s Setup Process</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-sbatch-function-and-its-options" id="toc-the-sbatch-function-and-its-options" class="nav-link active" data-scroll-target="#the-sbatch-function-and-its-options"><span class="toc-section-number">6.1</span>  The <code>sbatch</code> function and its options</a></li>
  <li><a href="#what-an-invocation-of-sbatch-could-look-like" id="toc-what-an-invocation-of-sbatch-could-look-like" class="nav-link" data-scroll-target="#what-an-invocation-of-sbatch-could-look-like"><span class="toc-section-number">6.2</span>  What an invocation of <code>sbatch</code> could look like</a></li>
  <li><a href="#let-us-submit-the-bwa_index.sh-job-to-slurm" id="toc-let-us-submit-the-bwa_index.sh-job-to-slurm" class="nav-link" data-scroll-target="#let-us-submit-the-bwa_index.sh-job-to-slurm"><span class="toc-section-number">6.3</span>  Let us submit the <code>bwa_index.sh</code> job to SLURM</a></li>
  <li><a href="#how-many-resources-did-that-job-use-seff" id="toc-how-many-resources-did-that-job-use-seff" class="nav-link" data-scroll-target="#how-many-resources-did-that-job-use-seff"><span class="toc-section-number">6.4</span>  How many resources did that job use? — <code>seff</code></a></li>
  <li><a href="#a-simple-job-with-default-sbatch-settings" id="toc-a-simple-job-with-default-sbatch-settings" class="nav-link" data-scroll-target="#a-simple-job-with-default-sbatch-settings"><span class="toc-section-number">6.5</span>  A simple job with default sbatch settings</a></li>
  <li><a href="#oh-no-i-need-to-stop-my-jobs-scancel" id="toc-oh-no-i-need-to-stop-my-jobs-scancel" class="nav-link" data-scroll-target="#oh-no-i-need-to-stop-my-jobs-scancel"><span class="toc-section-number">6.6</span>  Oh no! I need to stop my job(s): <code>scancel</code></a></li>
  <li><a href="#what-happens-if-we-exceed-our-resources" id="toc-what-happens-if-we-exceed-our-resources" class="nav-link" data-scroll-target="#what-happens-if-we-exceed-our-resources"><span class="toc-section-number">6.7</span>  What happens if we exceed our resources?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sbatch" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Submitting jobs with <code>sbatch</code></span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<ul>
<li><p>Up till now we have allocated ourselves two cores for <em>interactive</em> use.</p></li>
<li><p>This is what you would do if you were going to be doing computationally intensive things directly while hacking on the command line….</p></li>
<li><p>…or if you were going to start an R session and interactively work on some big data on it.</p></li>
<li><p>etc.</p></li>
</ul>
<p>Running an interactive shell on a compute node is also a great way to test your scripts.</p>
<p>However, once your scripts are tested, for most of your heavy computation, you will want to submit jobs as non-interactive <em>batch</em> jobs using SLURM’s <code>sbatch</code> function.</p>
<section id="the-sbatch-function-and-its-options" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="the-sbatch-function-and-its-options"><span class="header-section-number">6.1</span> The <code>sbatch</code> function and its options</h2>
<p>If you do <code>man sbatch</code> you will see an insanely large number of options and all sorts of complicated stuff.</p>
<p>You can get by with a fairly minimal set of options for almost everything you need to do. They are:</p>
<ul>
<li><code>--cpus-per-task=&lt;n&gt;</code>: the number of cores to use for the job. The syntax has you using it like this <code>--cpus-per-task=2</code>
<ul>
<li>On Sedna, the default is 1.</li>
</ul></li>
<li><code>--mem=&lt;size[units]</code>: How much total memory for the job. Example: <code>--mem=4G</code>
<ul>
<li>On Sedna, the default is about 4.7 Gb for each requested core.</li>
</ul></li>
<li><code>--time=[D-]HH:MM:SS</code>: How much time are you requesting? You don’t have to specify days, so you could say, <code>--time=1-12:00:00</code> for one day and twelve hours, or you could say <code>--time=36:00:00</code> for 36 hours.
<ul>
<li>On Sedna, the default is 8 hours.</li>
</ul></li>
<li><code>--output=&lt;filename pattern&gt;</code>: Where should anything on <code>stdout</code> that is not otherwise redirected be written to?</li>
<li><code>--error=&lt;filename pattern&gt;</code>: Where should anything on <code>stderr</code> that is not otherwise redirected be written to?</li>
</ul>
<p>On top of the options, <code>sbatch</code> takes a single required argument, which must be the path to a shell script (we know about those!) that the job will run.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Fun fact:
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you pass any arguments after the name of the shell script that you want <code>sbatch</code> to execute, those are interpreted as arguments to the shell script itself.</p>
</div>
</div>
</section>
<section id="what-an-invocation-of-sbatch-could-look-like" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="what-an-invocation-of-sbatch-could-look-like"><span class="header-section-number">6.2</span> What an invocation of <code>sbatch</code> could look like</h2>
<p>So, if we wanted to schedule a script called <code>MyScript.sh</code> to run with 4 cores and memory of 80Gb, with an allowance of 16 hours, and we wanted to tell SLURM where to capture any otherwise un-redirected <code>stdout</code> and <code>stderr</code>, we would type something like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Don't bother copying or pasting this.</strong></pre>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--cpus-per-task</span><span class="op">=</span>4 <span class="at">--mem</span><span class="op">=</span>80G <span class="at">--time</span><span class="op">=</span>16:00:00 <span class="at">--output</span><span class="op">=</span>myscript_stdout <span class="at">--error</span> myscript_error MyScript.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some points about that:</p>
<ul>
<li>Typing all of that is a huge hassle.</li>
<li>Most of the options will be specific to the actual job in <code>MyScript.sh</code></li>
</ul>
<p>So…<code>sbatch</code> allows you to store the options in your shell script on lines after the shebang line that are preceded by <code>#SBATCH</code>.</p>
<p>Let’s look at an example, in the file <code>scripts/bwa_index.sh</code></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Contents of the file scripts/bwa_index.sh</strong></pre>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=2:00:00</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=3G</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=bwa_index-%j.out</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=bwa_index-%j.err</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a little script to index the genome given</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># by the first positional parameter ($1)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># load the module that gives us the bwa software</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load aligners/bwa/0.7.17</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># make a directory for log output if it does not already exist</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="va">DIR</span><span class="op">=</span>results/log/bwa_index</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$DIR</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># run bwa index on the input</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="ex">bwa</span> index <span class="va">$1</span> <span class="op">&gt;</span> <span class="va">$DIR</span>/log.txt <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
What’s that %j in the output and error options?
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the above script, you will see</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=bwa_index-%j.out</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=bwa_index-%j.err</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this context, the <code>%j</code> gets replace by <code>sbatch</code> with the SLURM <code>JOBID</code>.</p>
</div>
</div>
</section>
<section id="let-us-submit-the-bwa_index.sh-job-to-slurm" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="let-us-submit-the-bwa_index.sh-job-to-slurm"><span class="header-section-number">6.3</span> Let us submit the <code>bwa_index.sh</code> job to SLURM</h2>
<p>Since all of the <code>sbatch</code> options are imbedded within the shell script, all that we need to do, now, is:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Paste this into your shell</strong></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> scripts/bwa_index.sh resources/genome.fasta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first argument is the script <code>scripts/bwa_index.sh</code> and the second, <code>resources/genome.fasta</code>, is the path to the genome that we want to index with <code>bwa</code>.</p>
<p>When this command executes, it returns the SLURM <code>JOBID</code>. Make a note of it.</p>
<p>Once you have launched the job, try using <code>myjobs</code> and <code>alljobs</code> to see your job running in the queue, and also everyone else’s. (You don’t have much time, because it doesn’t take very long).</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Hey! That job ran in the current working directory
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Note that our script ran <code>bwa index</code> by passing it the path of a reference genome specified as a <em>relative path</em>: the path was relative to our current working directory.</p>
<p>One of the wonderful features of SLURM is that, when <code>sbatch</code> runs your script, it does so from the current working directory of the shell in which you ran <code>sbatch</code>.</p>
<p>(I mention this because the first cluster I used was set up differently, and you had to explicitly tell it to run from the current working directory—which was the source of endless gnashing of teeth)</p>
</div>
</div>
</div>
<p>Once that job is done, use <code>ls -lrt resources</code> to see all the files that were newly created by the <code>bwa-index.sh</code> script.</p>
</section>
<section id="how-many-resources-did-that-job-use-seff" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="how-many-resources-did-that-job-use-seff"><span class="header-section-number">6.4</span> How many resources did that job use? — <code>seff</code></h2>
<p>When you first start doing bioinformatics, you will not be very familiar with how long each job will run, or how much memory it will need.</p>
<p>That takes some time, but one helpful utility, <code>seff</code>, will tell you the effective usage of the allocated resources by any <em>completed</em> job.</p>
<p>It’s simple to use:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Here is the sytnax</strong></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">seff</span> slurm-jobid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Self-study
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try that command, <code>seff slurm-jobid</code>, replacing <code>slurm-jobid</code> with the actual SLURM <code>JOBID</code> of the job that you just ran.</p>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
More tips on learning about past job resource use
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can also use the <code>sacct</code> command. Check it out with <code>man sacct</code>.</p>
<p>You can get information much like <code>seff</code> for your recent jobs with:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>An example use of sacct</strong></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">sacct</span>  <span class="at">--format</span> JobID,JobName,User,Group,State,Cluster,AllocCPUS,REQMEM,TotalCPU,Elapsed,MaxRSS,ExitCode,NNodes,NTasks <span class="at">-u</span> <span class="va">$(</span><span class="fu">whoami</span><span class="va">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="a-simple-job-with-default-sbatch-settings" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="a-simple-job-with-default-sbatch-settings"><span class="header-section-number">6.5</span> A simple job with default sbatch settings</h2>
<p>We jumped right into talking about all the most useful options for <code>sbatch</code>.</p>
<p>However, on Sedna (and, indeed, on most clusters), SLURM defines reasonable defaults for an <code>sbatch</code> job.</p>
<p>It even sends the <code>output</code> and <code>error</code> to reasonably named files, as we shall see.</p>
<p>The following lists the contents of a script called <code>simple-15.sh</code> that doesn’t do much:</p>
<ol type="1">
<li>It writes out the SLURM_JOB_ID to <code>stdout</code></li>
<li>It writes a message to <code>stderr</code></li>
<li>Then it just sits there for 15 minutes.</li>
</ol>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Contents of scripts/simple-15.sh</strong></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Running with Slurm Job ID: </span><span class="va">$SLURM_JOB_ID</span><span class="st">"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"This line is being written to stderr"</span> <span class="op">&gt;</span> /dev/stderr</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sleep</span> 900</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="oh-no-i-need-to-stop-my-jobs-scancel" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="oh-no-i-need-to-stop-my-jobs-scancel"><span class="header-section-number">6.6</span> Oh no! I need to stop my job(s): <code>scancel</code></h2>
</section>
<section id="what-happens-if-we-exceed-our-resources" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="what-happens-if-we-exceed-our-resources"><span class="header-section-number">6.7</span> What happens if we exceed our resources?</h2>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Memory gets allocated with cores or via <code>--mem</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is quite clear that the <code>--mem</code> option to <code>sbatch</code> is intended to increase the memory allocated to the job; however adding cores with <code>--cpus-per-task</code> also increases the memory available.</p>
<p>On Sedna, your job gets roughly 4700 Mb (4.7 Gb) of RAM for each <em>core</em> that it is allocated on one of the standard compute nodes.</p>
<p>Note, however, that if the programs running in your job are not multithreaded, then you might not be able to use all those cores. In which case, it might be better to specify additional memory allocation with <code>--mem</code>, and leave the other cores to other users.</p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./slurm.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Sedna and SLURM intro</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./summary.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>